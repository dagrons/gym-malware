import os
import joblib
import zerorpc


module_path = os.path.dirname(os.path.abspath(sys.modules[__name__].__file__))
SAMPLE_PATH = os.path.join(module_path, 'samples')

local_model = joblib.load(os.path.join(module_path, 'gradient_boosting.pkl'))
local_model_threshold = 0.90


class GradientBoostingServer(object):

    def get_score_malconv(self, bytez):
        return float(local_model.predict_sample(local_model.extract(bytez)))

    def get_label_malconv(self, bytez):
        score = self.get_score_malconv(bytez)
        label = float(self.get_score_malconv(bytez) >= local_model_threshold)
        return score, label


s = zerorpc.Server(GradientBoostingServer())

s.bind("tcp://127.0.0.1:4243")
s.run()
